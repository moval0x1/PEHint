# AppVeyor configuration for a Qt + CMake project
version: 1.0.{build}

# OS and image
image: Visual Studio 2019

# Environment setup
environment:
  QT_DIR: "C:\\Qt\\6.5.2\\msvc2019_64"
  CMAKE_EXE: "C:\\Qt\\Tools\\CMake_64\\bin\\cmake.exe"
  BUILD_DIR: "C:\\projects\\build\\Desktop_x86_windows_msvc2019_pe_64bit-Release"

# Install dependencies
install:
  # Add Qt to the PATH
  - set PATH=%QT_DIR%\bin;%PATH%
  # Verify CMake installation
  - "%CMAKE_EXE% --version"

# Build script
build_script:
  - mkdir "%BUILD_DIR%"
  - cd "%BUILD_DIR%"
  - |
    %CMAKE_EXE% ^
      -S %APPVEYOR_BUILD_FOLDER% ^
      -B %BUILD_DIR% ^
      "-DCMAKE_PREFIX_PATH:PATH=%QT_DIR%" ^
      "-DQT_DIR:PATH=%QT_DIR%\\lib\\cmake\\Qt6"
  - "%CMAKE_EXE% --build %BUILD_DIR% --config Release"

# Artifacts
artifacts:
  - path: build\Desktop_x86_windows_msvc2019_pe_64bit-Release\*.exe
    name: PEHint Executable
