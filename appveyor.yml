# AppVeyor CI configuration for PEHint

version: 1.0.{build}
image: Visual Studio 2022

environment:
  QT_VERSION: "6.5.2"

cache:
  - C:\Qt

install:
  - choco install curl --yes
  - cmd: |
      set QT_INSTALL_DIR=C:\Qt
      set QT_VERSION=6.5.2
      if not exist %QT_INSTALL_DIR%\%QT_VERSION% (
        curl -Lo qt-installer.exe https://download.qt.io/official_releases/online_installers/qt-unified-windows-x86-online.exe
        qt-installer.exe --script qt-install-script.qs
      )

build_script:
  - cmd: mkdir build
  - cmd: cd build
  - cmd: cmake -G "Ninja" -DCMAKE_BUILD_TYPE=Release -DCMAKE_PREFIX_PATH=C:\Qt\%QT_VERSION%\msvc2019_64 ..
  - cmd: cmake --build . --config Release

test_script:
  - cmd: cd build
  - cmd: ctest --output-on-failure

artifacts:
  - path: build\Release\*.exe
    name: PEHint Executables
